<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BlindтАСAssist AI</title>

  <!-- Load TensorFlow.js and COCOтАСSSD model from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.22.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
</head>
<body style="margin:0; padding:0; background:#000; color:#fff; text-align:center; font-family:sans-serif;">

  <h2>BlindтАСAssist AI (Prototype)</h2>
  <video id="video" autoplay playsinline style="width:100%; max-height:60vh; object-fit:cover;"></video>
  <canvas id="canvas" style="display:none;"></canvas>

  <div>
    <button id="btnStartCam">ЁЯУ╖ рдХреИрдорд░рд╛ рд╢реБрд░реВ рдХрд░реЗрдВ</button>
    <button id="btnDetect">ЁЯФН рдкрд╣рдЪрд╛рди рд╢реБрд░реВ рдХрд░реЗрдВ</button>
    <button id="btnVoice">ЁЯОд рдкреВрдЫреЗрдВ (Voice)</button>
  </div>

  <div id="chatUI" style="margin-top:20px;">
    <input type="text" id="aiInput" placeholder="AI рд╕реЗ рдкреВрдЫреЗрдВ..." style="width:80%; padding:8px;">
    <button id="btnAsk">тЮб рдкреВрдЫреЗрдВ</button>
    <p id="aiResponse" style="padding:10px; background:#111; border-radius:8px;"></p>
  </div>

  <script>
  // --- Globals ---
  let video = document.getElementById('video');
  let canvas = document.getElementById('canvas');
  let ctx = canvas.getContext('2d');
  let model = null;
  let isDetecting = false;
  let lastSpeakTime = {};

  // --- Utility: Hindi speech ---
  function speakHindi(text) {
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = 'hi-IN';
    speechSynthesis.speak(msg);
  }

  // --- Start camera (back) ---
  document.getElementById('btnStartCam').onclick = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: { exact: "environment" } },
        audio: false
      });
      video.srcObject = stream;
    } catch (err) {
      alert("рдХреИрдорд░рд╛ рдЕрдиреБрдорддрд┐ рджреЗрдВ рдФрд░ рджреБрдмрд╛рд░рд╛ рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред");
      console.error(err);
    }
  };

  // --- Load model ---
  async function loadModel() {
    if (!model) {
      model = await cocoSsd.load();
      console.log("Model loaded.");
    }
  }

  // --- Detection loop ---
  async function detectFrame() {
    if (!model || !isDetecting) return;
    if (video.readyState !== 4) {
      requestAnimationFrame(detectFrame);
      return;
    }

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const preds = await model.detect(video);
    preds.forEach(p => {
      const cls = p.class;
      const now = Date.now();
      if (!lastSpeakTime[cls] || now - lastSpeakTime[cls] > 3000) {
        speakHindi("рдЖрдкрдХреЗ рд╕рд╛рдордиреЗ " + cls + " рд╣реИ");
        lastSpeakTime[cls] = now;
      }
    });

    requestAnimationFrame(detectFrame);
  }

  // --- Detect button ---
  document.getElementById('btnDetect').onclick = async () => {
    await loadModel();
    isDetecting = true;
    speakHindi("рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреА рд╢реБрд░реБрдЖрдд рд╣реЛ рдЧрдпреА рд╣реИред");
    detectFrame();
  };

  // --- Voice input (speech recognition) + AI ask ---
  document.getElementById('btnVoice').onclick = () => {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
      alert("рдмреНрд░рд╛рдЙрдЬрд╝рд░ speech recognition рд╕рдкреЛрд░реНрдЯ рдирд╣реАрдВ рдХрд░рддрд╛ред Chrome/Edge рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░реЗрдВред");
      return;
    }
    const recog = new SpeechRecognition();
    recog.lang = 'hi-IN';
    recog.start();
    recog.onresult = (e) => {
      const text = e.results[0][0].transcript;
      document.getElementById('aiInput').value = text;
      askAI(text);
    };
    recog.onerror = (err) => {
      console.error("Voice error:", err);
      speakHindi("рдХреНрд╖рдорд╛ рдХрд░реЗрдВ, рдЖрд╡рд╛рдЬрд╝ рдирд╣реАрдВ рд╕реБрди рдкрд╛рдпрд╛ред");
    };
  };

  // --- Ask AI (free API placeholder) ---
  async function askAI(question) {
    document.getElementById('aiResponse').innerText = "рд╕реЛрдЪ рд░рд╣рд╛ рд╣реВрдБ...";
    speakHindi("рдореИрдВ рд╕реЛрдЪ рд░рд╣рд╛ рд╣реВрдБ...");

    try {
      const resp = await fetch("https://api.freeai.chat/your-endpoint", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ prompt: question })
      });
      const data = await resp.json();
      const ans = data.answer || "рдорд╛рдл рдХрд░реЗрдВ, рдЕрднреА рдЙрддреНрддрд░ рдирд╣реАрдВ рджреЗ рд╕рдХрддрд╛ред";
      document.getElementById('aiResponse').innerText = ans;
      speakHindi(ans);
    } catch (e) {
      console.error("AI error:", e);
      document.getElementById('aiResponse').innerText = "рдПрдЖрдИ рд╕реЗрд╡рд╛ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВред";
      speakHindi("рдПрдЖрдИ рд╕реЗрд╡рд╛ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВред");
    }
  }

  document.getElementById('btnAsk').onclick = () => {
    const q = document.getElementById('aiInput').value;
    if (q.trim().length) askAI(q);
  }

  </script>

</body>
</html>
